<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Niveles de Embalses en Colombia</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            color: #333;
            font-size: 13px;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 12px;
            font-size: 1.4em;
        }
        .controls {
            text-align: center;
            margin-bottom: 12px;
        }
        .btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            margin: 0 4px;
            font-size: 12px;
            transition: background-color 0.3s;
        }
        .btn:hover {
            background-color: #2980b9;
        }
        .table-container {
            overflow-x: auto;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border-radius: 5px;
            margin-bottom: 12px;
            /* max-width: 40%; */
        }
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        th {
            background-color: #3498db;
            color: white;
            padding: 7px 10px;
            text-align: left;
            position: sticky;
            top: 0;
            font-size: 12px;
        }
        td {
            padding: 5px 8px;
            border-bottom: 1px solid #e0e0e0;
            vertical-align: middle;
        }
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        tr:hover {
            background-color: #e9f7fe;
        }
        .positive {
            color: #27ae60;
            font-weight: bold;
        }
        .negative {
            color: #e74c3c;
            font-weight: bold;
        }
        .neutral {
            color: #7f8c8d;
        }
        .progress-container {
            width: 100%;
            background-color: #ecf0f1;
            border-radius: 2px;
            height: 14px;
            margin-top: 2px;
        }
        .progress-bar {
            height: 100%;
            border-radius: 2px;
            background-color: #3498db;
            text-align: center;
            color: white;
            font-size: 9px;
            line-height: 14px;
            min-width: 20%;
        }
        .low {
            background-color: #e74c3c;
        }
        .medium {
            background-color: #f39c12;
        }
        .high {
            background-color: #27ae60;
        }
        .overflow {
            background-color: #2980b9;
        }
        .footer {
            margin-top: 12px;
            font-size: 10px;
            color: #7f8c8d;
            text-align: center;
        }
        .level-cell {
            min-width: 90px;
        }
        .level-value {
            display: block;
            margin-bottom: 1px;
            font-weight: bold;
            font-size: 11px;
        }
        .volumen-cell, .aportes-value {
            text-align: right;
            font-size: 11px;
        }
        .diff-cell {
            text-align: right;
            font-size: 11px;
        }
        .region-cell {
            font-weight: bold;
            color: #2c3e50;
            font-size: 12px;
            padding: 5px 8px;
            background-color: #e3f2fd;
        }
        .region-row {
            background-color: #e3f2fd !important;
        }
        .compact-row {
            height: 24px;
        }
        .aportes-cell {
            min-width: 120px;
            font-size: 11px;
        }
        .aportes-change {
            font-size: 10px;
            display: block;
            margin-top: 1px;
        }
        .aportes-percent {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Niveles de Embalses en Colombia</h1>
    
    <div class="controls">
        <button class="btn" id="exportPNG">Exportar a PNG</button>
        <button class="btn" id="exportCSV">Exportar a CSV</button>
    </div>
    
    <div class="table-container" id="tableToExport">
        <table>
            <thead>
                <tr>
                    <th>Región</th>
                    <th>Embalse</th>
                    <th>Volumen (GWh-día)</th>
                    <th>Cambio</th>
                    <th>Nivel</th>
                    <th>Aportes Hídricos</th>
                </tr>
            </thead>
            <tbody>
                <!-- Región ANTIOQUIA -->
                <tr class="region-row compact-row">
                    <td class="region-cell" colspan="6">ANTIOQUIA</td>
                </tr>
                <tr class="compact-row">
                    <td></td>
                    <td>ITUANGO</td>
                    <td class="volumen-cell">23.00</td>
                    <td class="diff-cell positive">+2.55</td>
                    <td class="level-cell">
                        <span class="level-value">34.89%</span>
                        <div class="progress-container">
                            <div class="progress-bar medium" style="width: 34.89%"></div>
                        </div>
                    </td>
                    <td class="aportes-cell">
                        <span class="aportes-value">15.2 GWh-día</span>
                        <span class="aportes-change positive aportes-percent">+12.5%</span>
                        <span class="aportes-change">(+1.7 vs ayer)</span>
                    </td>
                </tr>
                <tr class="compact-row">
                    <td></td>
                    <td>MIRAFLORES</td>
                    <td class="volumen-cell">148.19</td>
                    <td class="diff-cell positive">+3.41</td>
                    <td class="level-cell">
                        <span class="level-value">32.34%</span>
                        <div class="progress-container">
                            <div class="progress-bar medium" style="width: 32.34%"></div>
                        </div>
                    </td>
                    <td class="aportes-cell">
                        <span class="aportes-value">42.8 GWh-día</span>
                        <span class="aportes-change positive aportes-percent">+8.3%</span>
                        <span class="aportes-change">(+3.3 vs ayer)</span>
                    </td>
                </tr>
                <tr class="compact-row">
                    <td></td>
                    <td>PEÑOL</td>
                    <td class="volumen-cell">3734.07</td>
                    <td class="diff-cell negative">-0.96</td>
                    <td class="level-cell">
                        <span class="level-value">90.04%</span>
                        <div class="progress-container">
                            <div class="progress-bar high" style="width: 90.04%"></div>
                        </div>
                    </td>
                    <td class="aportes-cell">
                        <span class="aportes-value">125.3 GWh-día</span>
                        <span class="aportes-change negative">-2.1%</span>
                        <span class="aportes-change">(-2.7 vs ayer)</span>
                    </td>
                </tr>
                <tr class="compact-row">
                    <td></td>
                    <td>PLAYAS</td>
                    <td class="volumen-cell">89.78</td>
                    <td class="diff-cell positive">+29.41</td>
                    <td class="level-cell">
                        <span class="level-value">94.61%</span>
                        <div class="progress-container">
                            <div class="progress-bar overflow" style="width: 94.61%"></div>
                        </div>
                    </td>
                    <td class="aportes-cell">
                        <span class="aportes-value">38.5 GWh-día</span>
                        <span class="aportes-change positive aportes-percent">+45.2%</span>
                        <span class="aportes-change">(+12.0 vs ayer)</span>
                    </td>
                </tr>
                <tr class="compact-row">
                    <td></td>
                    <td>PORCE II</td>
                    <td class="volumen-cell">84.90</td>
                    <td class="diff-cell positive">+19.48</td>
                    <td class="level-cell">
                        <span class="level-value">68.17%</span>
                        <div class="progress-container">
                            <div class="progress-bar high" style="width: 68.17%"></div>
                        </div>
                    </td>
                    <td class="aportes-cell">
                        <span class="aportes-value">28.7 GWh-día</span>
                        <span class="aportes-change positive aportes-percent">+32.8%</span>
                        <span class="aportes-change">(+7.1 vs ayer)</span>
                    </td>
                </tr>
                <tr class="compact-row">
                    <td></td>
                    <td>PORCE III</td>
                    <td class="volumen-cell">69.70</td>
                    <td class="diff-cell negative">-5.98</td>
                    <td class="level-cell">
                        <span class="level-value">62.16%</span>
                        <div class="progress-container">
                            <div class="progress-bar high" style="width: 62.16%"></div>
                        </div>
                    </td>
                    <td class="aportes-cell">
                        <span class="aportes-value">22.4 GWh-día</span>
                        <span class="aportes-change negative">-4.7%</span>
                        <span class="aportes-change">(-1.1 vs ayer)</span>
                    </td>
                </tr>
                <tr class="compact-row">
                    <td></td>
                    <td>PUNCHINA</td>
                    <td class="volumen-cell">26.03</td>
                    <td class="diff-cell negative">-0.16</td>
                    <td class="level-cell">
                        <span class="level-value">39.54%</span>
                        <div class="progress-container">
                            <div class="progress-bar medium" style="width: 39.54%"></div>
                        </div>
                    </td>
                    <td class="aportes-cell">
                        <span class="aportes-value">8.3 GWh-día</span>
                        <span class="aportes-change negative">-1.2%</span>
                        <span class="aportes-change">(-0.1 vs ayer)</span>
                    </td>
                </tr>
                <tr class="compact-row">
                    <td></td>
                    <td>RIOGRANDE2</td>
                    <td class="volumen-cell">507.94</td>
                    <td class="diff-cell positive">+5.42</td>
                    <td class="level-cell">
                        <span class="level-value">93.32%</span>
                        <div class="progress-container">
                            <div class="progress-bar overflow" style="width: 93.32%"></div>
                        </div>
                    </td>
                    <td class="aportes-cell">
                        <span class="aportes-value">185.2 GWh-día</span>
                        <span class="aportes-change positive aportes-percent">+3.8%</span>
                        <span class="aportes-change">(+6.8 vs ayer)</span>
                    </td>
                </tr>
                <tr class="compact-row">
                    <td></td>
                    <td>SAN LORENZO</td>
                    <td class="volumen-cell">379.63</td>
                    <td class="diff-cell positive">+2.69</td>
                    <td class="level-cell">
                        <span class="level-value">89.18%</span>
                        <div class="progress-container">
                            <div class="progress-bar high" style="width: 89.18%"></div>
                        </div>
                    </td>
                    <td class="aportes-cell">
                        <span class="aportes-value">132.7 GWh-día</span>
                        <span class="aportes-change positive aportes-percent">+1.8%</span>
                        <span class="aportes-change">(+2.4 vs ayer)</span>
                    </td>
                </tr>
                <tr class="compact-row">
                    <td></td>
                    <td>TRONERAS</td>
                    <td class="volumen-cell">71.62</td>
                    <td class="diff-cell positive">+6.05</td>
                    <td class="level-cell">
                        <span class="level-value">111.62%</span>
                        <div class="progress-container">
                            <div class="progress-bar overflow" style="width: 100%"></div>
                        </div>
                    </td>
                    <td class="aportes-cell">
                        <span class="aportes-value">25.8 GWh-día</span>
                        <span class="aportes-change positive aportes-percent">+9.2%</span>
                        <span class="aportes-change">(+2.2 vs ayer)</span>
                    </td>
                </tr>

                <!-- Región CALDAS -->
                <tr class="region-row compact-row">
                    <td class="region-cell" colspan="6">CALDAS</td>
                </tr>
                <tr class="compact-row">
                    <td></td>
                    <td>AMANI</td>
                    <td class="volumen-cell">179.71</td>
                    <td class="diff-cell positive">+0.29</td>
                    <td class="level-cell">
                        <span class="level-value">77.10%</span>
                        <div class="progress-container">
                            <div class="progress-bar high" style="width: 77.10%"></div>
                        </div>
                    </td>
                    <td class="aportes-cell">
                        <span class="aportes-value">62.4 GWh-día</span>
                        <span class="aportes-change positive aportes-percent">+0.5%</span>
                        <span class="aportes-change">(+0.3 vs ayer)</span>
                    </td>
                </tr>

                <!-- Región CARIBE -->
                <tr class="region-row compact-row">
                    <td class="region-cell" colspan="6">CARIBE</td>
                </tr>
                <tr class="compact-row">
                    <td></td>
                    <td>URRA1</td>
                    <td class="volumen-cell">129.67</td>
                    <td class="diff-cell negative">-1.89</td>
                    <td class="level-cell">
                        <span class="level-value">81.33%</span>
                        <div class="progress-container">
                            <div class="progress-bar high" style="width: 81.33%"></div>
                        </div>
                    </td>
                    <td class="aportes-cell">
                        <span class="aportes-value">45.8 GWh-día</span>
                        <span class="aportes-change negative">-2.8%</span>
                        <span class="aportes-change">(-1.3 vs ayer)</span>
                    </td>
                </tr>

                <!-- Región CENTRO -->
                <tr class="region-row compact-row">
                    <td class="region-cell" colspan="6">CENTRO</td>
                </tr>
                <tr class="compact-row">
                    <td></td>
                    <td>AGREGADO BOGOTA</td>
                    <td class="volumen-cell">2523.58</td>
                    <td class="diff-cell positive">+4.23</td>
                    <td class="level-cell">
                        <span class="level-value">63.22%</span>
                        <div class="progress-container">
                            <div class="progress-bar high" style="width: 63.22%"></div>
                        </div>
                    </td>
                    <td class="aportes-cell">
                        <span class="aportes-value">845.1 GWh-día</span>
                        <span class="aportes-change positive aportes-percent">+1.2%</span>
                        <span class="aportes-change">(+10.2 vs ayer)</span>
                    </td>
                </tr>
                <tr class="compact-row">
                    <td></td>
                    <td>BETANIA</td>
                    <td class="volumen-cell">102.35</td>
                    <td class="diff-cell positive">+1.61</td>
                    <td class="level-cell">
                        <span class="level-value">84.86%</span>
                        <div class="progress-container">
                            <div class="progress-bar high" style="width: 84.86%"></div>
                        </div>
                    </td>
                    <td class="aportes-cell">
                        <span class="aportes-value">35.2 GWh-día</span>
                        <span class="aportes-change positive aportes-percent">+4.8%</span>
                        <span class="aportes-change">(+1.6 vs ayer)</span>
                    </td>
                </tr>
                <tr class="compact-row">
                    <td></td>
                    <td>EL QUIMBO</td>
                    <td class="volumen-cell">1019.84</td>
                    <td class="diff-cell positive">+5.17</td>
                    <td class="level-cell">
                        <span class="level-value">94.37%</span>
                        <div class="progress-container">
                            <div class="progress-bar overflow" style="width: 94.37%"></div>
                        </div>
                    </td>
                    <td class="aportes-cell">
                        <span class="aportes-value">385.4 GWh-día</span>
                        <span class="aportes-change positive aportes-percent">+2.3%</span>
                        <span class="aportes-change">(+8.7 vs ayer)</span>
                    </td>
                </tr>
                <tr class="compact-row">
                    <td></td>
                    <td>MUNA</td>
                    <td class="volumen-cell">22.14</td>
                    <td class="diff-cell positive">+0.28</td>
                    <td class="level-cell">
                        <span class="level-value">40.33%</span>
                        <div class="progress-container">
                            <div class="progress-bar medium" style="width: 40.33%"></div>
                        </div>
                    </td>
                    <td class="aportes-cell">
                        <span class="aportes-value">7.5 GWh-día</span>
                        <span class="aportes-change positive aportes-percent">+1.3%</span>
                        <span class="aportes-change">(+0.1 vs ayer)</span>
                    </td>
                </tr>
                <tr class="compact-row">
                    <td></td>
                    <td>PRADO</td>
                    <td class="volumen-cell">57.69</td>
                    <td class="diff-cell negative">-0.27</td>
                    <td class="level-cell">
                        <span class="level-value">63.79%</span>
                        <div class="progress-container">
                            <div class="progress-bar high" style="width: 63.79%"></div>
                        </div>
                    </td>
                    <td class="aportes-cell">
                        <span class="aportes-value">19.8 GWh-día</span>
                        <span class="aportes-change negative">-0.9%</span>
                        <span class="aportes-change">(-0.2 vs ayer)</span>
                    </td>
                </tr>
                <tr class="compact-row">
                    <td></td>
                    <td>TOPOCORO</td>
                    <td class="volumen-cell">954.40</td>
                    <td class="diff-cell negative">-3.11</td>
                    <td class="level-cell">
                        <span class="level-value">92.47%</span>
                        <div class="progress-container">
                            <div class="progress-bar high" style="width: 92.47%"></div>
                        </div>
                    </td>
                    <td class="aportes-cell">
                        <span class="aportes-value">325.7 GWh-día</span>
                        <span class="aportes-change negative">-1.5%</span>
                        <span class="aportes-change">(-5.0 vs ayer)</span>
                    </td>
                </tr>

                <!-- Región ORIENTE -->
                <tr class="region-row compact-row">
                    <td class="region-cell" colspan="6">ORIENTE</td>
                </tr>
                <tr class="compact-row">
                    <td></td>
                    <td>CHUZA</td>
                    <td class="volumen-cell">890.81</td>
                    <td class="diff-cell neutral">0.00</td>
                    <td class="level-cell">
                        <span class="level-value">91.72%</span>
                        <div class="progress-container">
                            <div class="progress-bar overflow" style="width: 91.72%"></div>
                        </div>
                    </td>
                    <td class="aportes-cell">
                        <span class="aportes-value">315.2 GWh-día</span>
                        <span class="aportes-change neutral">0.0%</span>
                        <span class="aportes-change">(0.0 vs ayer)</span>
                    </td>
                </tr>
                <tr class="compact-row">
                    <td></td>
                    <td>ESMERALDA</td>
                    <td class="volumen-cell">980.67</td>
                    <td class="diff-cell positive">+0.22</td>
                    <td class="level-cell">
                        <span class="level-value">87.20%</span>
                        <div class="progress-container">
                            <div class="progress-bar high" style="width: 87.20%"></div>
                        </div>
                    </td>
                    <td class="aportes-cell">
                        <span class="aportes-value">342.8 GWh-día</span>
                        <span class="aportes-change positive aportes-percent">+0.1%</span>
                        <span class="aportes-change">(+0.3 vs ayer)</span>
                    </td>
                </tr>
                <tr class="compact-row">
                    <td></td>
                    <td>GUAVIO</td>
                    <td class="volumen-cell">1372.86</td>
                    <td class="diff-cell neutral">0.00</td>
                    <td class="level-cell">
                        <span class="level-value">94.72%</span>
                        <div class="progress-container">
                            <div class="progress-bar overflow" style="width: 94.72%"></div>
                        </div>
                    </td>
                    <td class="aportes-cell">
                        <span class="aportes-value">485.3 GWh-día</span>
                        <span class="aportes-change neutral">0.0%</span>
                        <span class="aportes-change">(0.0 vs ayer)</span>
                    </td>
                </tr>

                <!-- Región VALLE -->
                <tr class="region-row compact-row">
                    <td class="region-cell" colspan="6">VALLE</td>
                </tr>
                <tr class="compact-row">
                    <td></td>
                    <td>ALTOANCHICAYA</td>
                    <td class="volumen-cell">9.76</td>
                    <td class="diff-cell positive">+2.38</td>
                    <td class="level-cell">
                        <span class="level-value">26.73%</span>
                        <div class="progress-container">
                            <div class="progress-bar low" style="width: 26.73%"></div>
                        </div>
                    </td>
                    <td class="aportes-cell">
                        <span class="aportes-value">3.2 GWh-día</span>
                        <span class="aportes-change positive aportes-percent">+32.5%</span>
                        <span class="aportes-change">(+0.8 vs ayer)</span>
                    </td>
                </tr>
                <tr class="compact-row">
                    <td></td>
                    <td>CALIMA1</td>
                    <td class="volumen-cell">191.91</td>
                    <td class="diff-cell positive">+0.21</td>
                    <td class="level-cell">
                        <span class="level-value">87.62%</span>
                        <div class="progress-container">
                            <div class="progress-bar high" style="width: 87.62%"></div>
                        </div>
                    </td>
                    <td class="aportes-cell">
                        <span class="aportes-value">68.4 GWh-día</span>
                        <span class="aportes-change positive aportes-percent">+0.3%</span>
                        <span class="aportes-change">(+0.2 vs ayer)</span>
                    </td>
                </tr>
                <tr class="compact-row">
                    <td></td>
                    <td>SALVAJINA</td>
                    <td class="volumen-cell">448.99</td>
                    <td class="diff-cell negative">-3.60</td>
                    <td class="level-cell">
                        <span class="level-value">85.50%</span>
                        <div class="progress-container">
                            <div class="progress-bar high" style="width: 85.50%"></div>
                        </div>
                    </td>
                    <td class="aportes-cell">
                        <span class="aportes-value">158.7 GWh-día</span>
                        <span class="aportes-change negative">-2.2%</span>
                        <span class="aportes-change">(-3.6 vs ayer)</span>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <div class="footer">
        Actualizado: 29 de julio de 2023 | Datos en GWh-día | Niveles exactos<br>
        <span style="color: #2980b9">●</span> Nivel ≥98% (riesgo de vertimiento) | 
        <span style="color: #27ae60">●</span> Nivel ≥70% | 
        <span style="color: #f39c12">●</span> Nivel ≥30% | 
        <span style="color: #e74c3c">●</span> Nivel <30%
    </div>

    <script>
        document.getElementById('exportPNG').addEventListener('click', function() {
            html2canvas(document.getElementById('tableToExport')).then(canvas => {
                canvas.toBlob(function(blob) {
                    saveAs(blob, 'embalses_colombia.png');
                });
            });
        });

        document.getElementById('exportCSV').addEventListener('click', function() {
            let csv = 'Región Hidrológica,Embalse,Volumen (GWh-día),Cambio (GWh-día),Nivel (%),Aportes (GWh-día),Cambio Aportes (%),Cambio Aportes (GWh-día)\n';
            
            let currentRegion = '';
            
            document.querySelectorAll('tbody tr').forEach(row => {
                if (row.classList.contains('region-row')) {
                    currentRegion = row.querySelector('.region-cell').textContent;
                } else {
                    const cells = row.cells;
                    const embalse = cells[1].textContent;
                    const volumen = cells[2].textContent;
                    const cambio = cells[3].textContent;
                    const nivel = cells[4].querySelector('.level-value').textContent.replace('%', '');
                    
                    // Extraer datos de aportes
                    const aportesText = cells[5].textContent;
                    const aportesMatch = aportesText.match(/(\d+\.\d+) GWh-día.*?([+-]?\d+\.\d+)%.*?([+-]?\d+\.\d+)/);
                    
                    const aportes = aportesMatch ? aportesMatch[1] : '';
                    const cambioAportesPercent = aportesMatch ? aportesMatch[2] : '';
                    const cambioAportesGwh = aportesMatch ? aportesMatch[3] : '';
                    
                    csv += `"${currentRegion}","${embalse}",${volumen},${cambio},${nivel},${aportes},${cambioAportesPercent},${cambioAportesGwh}\n`;
                }
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            saveAs(blob, 'embalses_colombia.csv');
        });
    </script>
</body>
</html>